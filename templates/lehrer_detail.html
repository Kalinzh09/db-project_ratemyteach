<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>{{ lehrer.vorname }} {{ lehrer.name }}</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>
    <h1>{{ lehrer.vorname }} {{ lehrer.name }}</h1>
    <a href="{{ url_for('lehrer_liste') }}" style="color:white;">← Zurück</a>
</header>

<div class="container">

<!-- ================= STECKBRIEF ================= -->

<div class="card steckbrief">
    <h2>{{ lehrer.vorname }} {{ lehrer.name }}</h2>
    <p><strong>Fach:</strong> {{ lehrer.fach }}</p>
    <p><strong>Email:</strong> {{ lehrer.email }}</p>

    <p><strong>Durchschnitt:</strong>
        {% if lehrer.avg_sterne %}
            ⭐ {{ lehrer.avg_sterne }} / 5 ({{ lehrer.anzahl }} Bewertungen)
        {% else %}
            Noch keine Bewertungen
        {% endif %}
    </p>
</div>

<!-- ================= STATS ================= -->

<div class="card">
    <h3>Lehrer-Statistiken</h3>
    <canvas id="radarChart"></canvas>
</div>

<!-- ================= FORM ================= -->

<div class="card">
<h3>Bewertung abgeben</h3>

<form method="post">

<label>Verständlichkeit</label>
<input type="range" min="1" max="5" step="0.5" name="verstandlichkeit" required>

<label>Fairness</label>
<input type="range" min="1" max="5" step="0.5" name="fairness" required>

<label>Sympathie</label>
<input type="range" min="1" max="5" step="0.5" name="sympathie" required>

<label>Organisation</label>
<input type="range" min="1" max="5" step="0.5" name="organisation" required>

<label>Fachwissen</label>
<input type="range" min="1" max="5" step="0.5" name="fachwissen" required>

<textarea name="kommentar" placeholder="Kommentar..."></textarea>

<button type="submit">Absenden</button>
</form>
</div>

<!-- ================= BEWERTUNGEN ================= -->

{% for b in bewertungen %}
<div class="card">
<strong>{{ b.username }}</strong><br>

{% set full = b.sterne|int %}
{% set half = 1 if (b.sterne - full) >= 0.5 else 0 %}
{% set empty = 5 - full - half %}

{% for i in range(full) %}⭐{% endfor %}
{% if half %}✨{% endif %}
{% for i in range(empty) %}☆{% endfor %}

({{ b.sterne }}/5)<br>

<small>{{ b.datum }}</small>
<p>{{ b.kommentar }}</p>
</div>
{% endfor %}

</div>

<!-- ================= SPIDER CHART ================= -->

<script>
const data = {
labels: ["Verständlichkeit", "Fairness", "Sympathie", "Organisation", "Fachwissen"],
datasets: [{
label: "Durchschnitt",
data: [
{{ lehrer.verstandlichkeit or 0 }},
{{ lehrer.fairness or 0 }},
{{ lehrer.sympathie or 0 }},
{{ lehrer.organisation or 0 }},
{{ lehrer.fachwissen or 0 }}
],
fill: true,
backgroundColor: "rgba(79,70,229,0.2)",
borderColor: "#4f46e5",
pointBackgroundColor: "#4f46e5"
}]
};

new Chart(document.getElementById("radarChart"), {
type: "radar",
data: data,
options: {
responsive: true,
scales: {
r: {
min: 0,
max: 5,
ticks: { stepSize: 1 }
}
}
}
});
</script>

</body>
</html>
