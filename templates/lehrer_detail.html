<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>{{ lehrer.vorname }} {{ lehrer.name }}</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<!-- Chart.js f√ºr Spider Chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* Header rechts: Button + Zur√ºck sauber nebeneinander */
.header-right {
    display: flex;
    gap: 12px;
    align-items: center;
}

/* Darkmode Button im Header (passt zu deinem Look) */
#darkmode-btn {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.35);
    color: white;
    padding: 8px 10px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.95rem;
}
#darkmode-btn:hover {
    border-color: rgba(255,255,255,0.7);
}

/* ---- Dark Mode: nur Erg√§nzungen, nichts √ºberschreibt dein Layout kaputt ---- */
body.dark .card {
    background: #0b1220;
    color: #e5e7eb;
    box-shadow: 0 10px 25px rgba(255,255,255,0.03);
}

body.dark textarea,
body.dark input {
    background: #020617;
    color: #f9fafb;
    border: 1px solid #1e293b;
}

/* Chart "Canvas" damit es in dark besser wirkt */
body.dark canvas {
    background: transparent;
}
</style>
</head>

<body>

<header>
    <h1>{{ lehrer.vorname }} {{ lehrer.name }}</h1>

    <div class="header-right">
        <button id="darkmode-btn" onclick="toggleDarkMode()">üåô</button>
        <a href="{{ url_for('lehrer_liste') }}" style="color:white;">‚Üê Zur√ºck</a>
    </div>
</header>

<div class="container">

<!-- ================= STATS ================= -->
<div class="card">
    <h3>Lehrer-Statistiken</h3>
    <canvas id="radarChart"></canvas>
</div>

{% if anzbewertungenuser == 0 %}
<!-- ================= FORM ================= -->
<div class="card">
<h3>Bewertung abgeben</h3>

<form method="post">

<label>Verst√§ndlichkeit</label>
<input type="range" min="1" max="5" step="0.5" name="verstandlichkeit" required>

<label>Fairness</label>
<input type="range" min="1" max="5" step="0.5" name="fairness" required>

<label>Sympathie</label>
<input type="range" min="1" max="5" step="0.5" name="sympathie" required>

<label>Organisation</label>
<input type="range" min="1" max="5" step="0.5" name="organisation" required>

<label>Fachwissen</label>
<input type="range" min="1" max="5" step="0.5" name="fachwissen" required>

<textarea name="kommentar" placeholder="Kommentar..."></textarea>

<button type="submit" onclick="this.disabled=true; this.innerText='Wird gesendet‚Ä¶'; this.form.submit();">
    Absenden
</button>

</form>
</div>
{% endif %}

<!-- ================= BEWERTUNGEN ================= -->
{% for b in bewertungen %}
<div class="card">
<strong>{{ b.username }}</strong><br>

{% set full = b.sterne|int %}
{% set half = 1 if (b.sterne - full) >= 0.5 else 0 %}
{% set empty = 5 - full - half %}

{% for i in range(full) %}
    <span class="star full">‚òÖ</span>
{% endfor %}

{% if half %}
    <span class="star half">‚òÖ</span>
{% endif %}

{% for i in range(empty) %}
    <span class="star empty">‚òÜ</span>
{% endfor %}

({{ b.sterne }}/5)<br>

<small>{{ b.datum }}</small>
<p>{{ b.kommentar }}</p>
</div>
{% endfor %}

</div>

<!-- ================= SPIDER CHART ================= -->
<script>
const data = {
labels: ["Verst√§ndlichkeit", "Fairness", "Sympathie", "Organisation", "Fachwissen"],
datasets: [{
label: "Durchschnitt",
data: [
{{ stats.verstandlichkeit }},
{{ stats.fairness }},
{{ stats.sympathie }},
{{ stats.organisation }},
{{ stats.fachwissen }}
],
fill: true
}]
};

new Chart(document.getElementById("radarChart"), {
type: "radar",
data: data,
options: {
responsive: true,
scales: {
r: {
min: 0,
max: 5,
ticks: { stepSize: 1 }
}
}
}
});
</script>

<!-- ================= DARK MODE SCRIPT (global via localStorage) ================= -->
<script>
function toggleDarkMode() {
    document.body.classList.toggle("dark");
    localStorage.setItem(
        "darkmode",
        document.body.classList.contains("dark") ? "on" : "off"
    );
}

if (localStorage.getItem("darkmode") === "on") {
    document.body.classList.add("dark");
}
</script>

</body>
</html>
